<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Iniciar sesión - Saferoad</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <section class="seccion-contacto">
      <h2>Iniciar sesión</h2>
      <form id="login-form" aria-label="Iniciar sesión">
        <label for="username">Usuario</label>
        <input type="text" id="username" placeholder="Usuario" required />

        <label for="password">Contraseña</label>
        <input type="password" id="password" placeholder="Contraseña" required />

        <button type="submit">Ingresar</button>
        <p>¿No tienes cuenta? <a href="register.html">Regístrate</a></p>
        <p><a href="#" id="forgot-password">¿Olvidaste tu contraseña?</a></p>
      </form>
      <div id="login-feedback" aria-live="polite"></div>
    </section>

    <script>
      document
        .getElementById("login-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();
              const user = document.getElementById("username").value.trim();
              const pass = document.getElementById("password").value.trim();
              const users = JSON.parse(localStorage.getItem('safaroadUsers') || '[]');
              const dbUser = users.find(u => u.username === user);
              if (dbUser && dbUser.password === pass) {
                localStorage.setItem('safaroadUser', user);
                localStorage.setItem('safaroadUserRole', dbUser.role || 'usuario');
                window.location.href = 'app.html';
              } else {
                document.getElementById('login-feedback').innerText = '❌ Usuario o contraseña incorrectos.';
              }
        });

          document.getElementById('forgot-password').addEventListener('click', (e)=>{ e.preventDefault(); const user = prompt('Ingresa tu usuario para recuperar contraseña'); if (!user) return; const users = JSON.parse(localStorage.getItem('safaroadUsers')||'[]'); const dbUser = users.find(u=>u.username===user); if(!dbUser) { document.getElementById('login-feedback').innerText = 'Usuario no encontrado'; return; } // simulate
            const key = 'pwRecover_' + user; const token = Math.random().toString(36).slice(2,8); localStorage.setItem(key, token); alert('Código de recuperación (simulado): ' + token); const newPass = prompt('Ingrese nueva contraseña para ' + user); if(newPass && newPass.length>=6){ dbUser.password = newPass; localStorage.setItem('safaroadUsers', JSON.stringify(users)); document.getElementById('login-feedback').innerText = '✅ Contraseña actualizada'; } else { document.getElementById('login-feedback').innerText = 'Contraseña no cambiada (mínimo 6 caracteres)'; }});

          // Theme toggle for login page
          (function(){ const btn = document.getElementById('theme-toggle-index'); if(!btn) return; const current = localStorage.getItem('safaroadTheme') || 'light'; if (current === 'dark') document.documentElement.setAttribute('data-theme','dark'); btn.addEventListener('click', ()=>{ const newt = (localStorage.getItem('safaroadTheme')||'light') === 'light' ? 'dark' : 'light'; localStorage.setItem('safaroadTheme', newt); document.documentElement.setAttribute('data-theme', newt); }); })();
    </script>
  </body>
</html>
